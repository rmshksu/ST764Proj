name: publish bookdown

on:
  push:
    branches:
      - main
      - release/*
jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
    - name: checkout repository
      uses: actions/checkout@v2

    - name: setup R
      uses: r-lib/actions/setup-r@v2

    - name: cache R rackages
      uses: actions/cache@v2
      with:
        path: ${{ env.R_LIBS_USER }}
        key: ${{ runner.os }}-r-${{ hashFiles('**/DESCRIPTION', '**/renv.lock') }}
        restore-keys: ${{ runner.os }}-r-

    - name: install dependencies
      run: |
        install.packages('remotes')
        remotes::install_deps(dependencies = TRUE)
        remotes::install_github('rstudio/bookdown')

    - name: build book
      run: |
        Rscript -e "bookdown::render_book('index.Rmd', 'bookdown::gitbook')"

    - name: deploy to the hub pages
      uses: peaceiris/actions-gh-pages@v3
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        publish_dir: ./_book